<%- include('layout', {title:'Dashboard'}) %>
<div class="row">
  <aside class="col-md-3">
    <div class="card p-3 mb-3">
      <a href="/policies/new" class="btn btn-primary w-100 mb-2">+ Create New Policy</a>
      <a href="/policies" class="d-block mb-1">All Policies</a>
      <a href="/policies?filter=dueThisMonth" class="d-block mb-1">This Month Due</a>
      <a href="/policies?filter=pending" class="d-block mb-1">Pending</a>
      <a href="/logout" class="d-block mt-3 text-danger">Logout</a>
    </div>
  </aside>
  <main class="col-md-9">
    <h4>All Policies</h4>
    <div class="row">
      <% if (policies.length === 0) { %>
        <div class="col-12"><div class="alert alert-info">No policies yet</div></div>
      <% } %>
      <% policies.forEach(p => { %>
        <div class="col-12 col-md-6 col-lg-4 mb-3">
          <div class="card h-100">
            <div class="card-body d-flex flex-column">
              <h5 class="card-title"><%= p.holderName %></h5>
              <p class="mb-1"><strong>Policy No:</strong> <%= p.policyNumber || '-' %></p>
              <p class="mb-1"><strong>Next Due:</strong> <%= p.nextDueDate ? p.nextDueDate.toDateString() : '-' %></p>
              <p class="mb-1"><strong>Invested:</strong> <%= p.totalValue || 0 %></p>
              <div class="mt-auto d-flex gap-2">
                <a href="/policies/<%= p._id %>" class="btn btn-sm btn-outline-primary">View</a>
                <a href="/policies/<%= p._id %>/edit" class="btn btn-sm btn-outline-secondary">Edit</a>
                <form action="/policies/<%= p._id %>?_method=DELETE" method="POST" style="display:inline">
                  <button class="btn btn-sm btn-outline-danger">Delete</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      <% }) %>
    </div>
  </main>
</div>